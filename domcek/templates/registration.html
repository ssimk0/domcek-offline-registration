{% extends "layout.html" %}
{% block title %}
  Stiahnutie dat
{% endblock %}

{% block registration_menu %}active{% endblock %}

{% block body %}
  <div class="container-fluid">
    <div class="row justify-content-center" >
      <div class="col-12">
          <div class="row mt-5">
              <form method="get" action="/registration" class="col-4">
                  <div class="form-group">
                      <input placeholder="Vyhľadať" class="form-control" name="q">
                  </div>
              </form>
          </div>
          <table class="table table-striped table-hover table-sm mt-2 mb-5">
              <thead class="thead-dark">
                <tr>
                    <th>Meno</th>
                    <th>Priezvisko</th>
                    <th>Telefone čislo</th>
                    <th>Mesto</th>
                    <th>Dátum narodenia</th>
                    <th>Variabilne čislo</th>
                    <th>Potrebuje doplatiť</th>
                    <th>Skupinka</th>
                    <th>Je Prihlásený</th>
                    <th>Akcie</th>
                </tr>
              </thead>
              <tbody>
                {% if participants != None %}
                    {% if participants |count > 0 and filter != None and filter != '' %}
                        {% for participant in participants %}

                            {% if participant.payment_number %}
                                {% set class = 'subscribed' %}
                            {% endif %}

                            {% if participant.was_on_event %}
                                {% set class = 'registered' %}
                            {% endif %}

                            {% if participant.birth_date | year_is_more(years=18) %}
                                {% set class = 'need_sing_from_parents' %}
                            {% endif %}
                            <tr class="{{class}}">
                                <td>{{ participant.first_name }}</td>
                                <td>{{ participant.last_name }}</td>
                                <td>{{ participant.phone }}</td>
                                <td>{{ participant.city }}</td>
                                <td>{{ participant.birth_date }}</td>
                                <td>{{ participant.payment_number }}</td>
                                <td>
                                    {% if participant.need_pay %}
                                        {% set amount = participant.need_pay - participant.paid %}
                                        {{ amount }}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if participant.group_name %}
                                      {{ participant.group_name }}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if participant.payment_number %}
                                        Ano
                                    {% else %}
                                        Nie
                                    {% endif %}
                                </td>
                                <td><a href="/registration/participant/{{participant.user_id}}">Zaregistrovať</a></td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="12" class="text-center">
                                Použi alebo zmeň filter na vyhľadanie konkretneho učasnika
                            </td>
                        </tr>
                    {% endif %}
                {% else %}
                    <tr>
                        <td colspan="12">
                            <form method="post" action="/sync/download">
                              <div class="text-center pb-2">
                                  <p>Nemáš stiahnute data pre registraciu</p>
                                  <div class="form-group">
                                      <label for="token">Token</label>
                                      <input type="text" required class="token" id="token" name="token">
                                  </div>
                                  <button class="btn btn-primary" type="submit">Stiahnuť Data</button>
                              </div>
                            </form>
                        </td>
                    </tr>
                {% endif %}
              </tbody>
          </table>
      </div>
    </div>
  </div>
{% endblock %}